@model Chat.Models.ChatRoomLabelViewModelList
@{
    ViewBag.Title = "ChatRoomsList";
    Layout = "~/Views/Shared/_ChatLayout.cshtml";
}

<h2>ChatRoomsList</h2>
<div>
    <span>New room:</span>
    <div>
        <span class="error"></span>
        @Html.TextBox("roomName", "", new { required = "required" })
        <input type="button" value="Add" id="btnAdd" />
    </div>

</div>
<div id="rooms">
    @Html.Partial("ChatRoomsLabelsList", Model)
</div>

@section scripts{
    <script src="~/Scripts/jquery.signalR-2.2.2.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>

    <script>
        $(function (e) {
            // Reference the auto-generated proxy for the hub.
            var rooms = $.connection.chatHub;
            // Create a function that the hub can call back to display messages.
            rooms.client.addNewMessageToPage = function (name, message) {
                $.ajax({
                    async: true,
                    method: "GET",
                    url: "/ChatRoom/GetChatRoomsLabelsList",
                }
                ).done(function (partialViewResult) {
                    $("#rooms").html(partialViewResult);
                });

            };
            // Start the connection.
            $.connection.hub.start().done(function () {
                $('#btnAdd').click(function (e) {
                    var roomName = $('#roomName').val();
                    $.ajax({
                        async: true,
                        method: "POST",
                        url: "/ChatRoom/NewRoom",
                        data: { roomName: roomName },
                        success: function (response) {
                            rooms.server.send(null, null);
                            $('#roomName').val('')
                            $(".error").html('');
                        },
                        error: function (response) {
                            e.preventDefault();
                            $(".error").html(response.responseText);
                        }
                    }
                    );
                });
            });
        });
    </script>
}




